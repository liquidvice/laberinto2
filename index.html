<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alicia en el Laberinto</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #3b0066, #8a2be2);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    margin: 0;
  }
  #scoreboard, #timer, #warning, #finalMessage, #levelMessage {
    margin: 5px 0;
    text-align: center;
  }
  #maze {
    display: grid;
    grid-gap: 2px;
    margin: 10px 0;
  }
  .cell {
    width: 50px;
    height: 50px;
    background: #444;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
  }
  .goal { background: #28a745; }
  .tea { background: #ffc107; }
  button {
    padding: 8px 16px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    background-color: #8a2be2;
    color: white;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover { background-color: #5e1b96; }
</style>
</head>
<body>
  <h1>Alicia en el Laberinto</h1>
  <div id="scoreboard">Puntaje: 0 | Mejor: 0</div>
  <div id="timer">Tiempo: 0 s | Mejor: 0 s</div>
  <div id="warning"></div>
  <div id="levelMessage"></div>
  <div id="maze"></div>
  <div id="finalMessage"></div>
  <button onclick="restartGame()">Reiniciar</button>
  <button onclick="newMaze()">Nuevo Laberinto</button>

<script>
const mazeContainer = document.getElementById("maze");
const scoreDisplay = document.getElementById("scoreboard");
const timerDisplay = document.getElementById("timer");
const warning = document.getElementById("warning");
const finalMessage = document.getElementById("finalMessage");
const levelMessage = document.getElementById("levelMessage");

let rows = 5, cols = 5;
let player = { x: 0, y: 0 };
let goal = { x: 4, y: 4 };
let teas = [];
let score = 0;
let bestScore = localStorage.getItem("bestScore") || 0;
let bestTime = localStorage.getItem("bestTime") || 0;
let level = 1;
let maxLevel = 5;
let timer = 0, timerInterval, elapsedTime = 0;

scoreDisplay.textContent = `Puntaje: ${score} | Mejor: ${bestScore}`;
timerDisplay.textContent = `Tiempo: ${timer} s | Mejor: ${bestTime} s`;

function setupMaze() {
  mazeContainer.innerHTML = "";
  mazeContainer.style.gridTemplateColumns = `repeat(${cols}, 50px)`;
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      const cell = document.createElement("div");
      cell.classList.add("cell");
      cell.id = `cell-${x}-${y}`;
      mazeContainer.appendChild(cell);
    }
  }
  player = { x: 0, y: 0 };
  goal = { x: cols - 1, y: rows - 1 };
  teas = [];
  for (let i = 0; i < Math.floor((rows * cols) / 6); i++) {
    let tx, ty;
    do {
      tx = Math.floor(Math.random() * cols);
      ty = Math.floor(Math.random() * rows);
    } while ((tx === 0 && ty === 0) || (tx === goal.x && ty === goal.y) || teas.some(t => t.x === tx && t.y === ty));
    teas.push({ x: tx, y: ty });
  }
  drawMaze();
  clearInterval(timerInterval);
  if (level === 1) elapsedTime = 0;
  timer = 0;
  timerDisplay.textContent = `Tiempo: ${timer} s | Mejor: ${bestTime} s`;
  timerInterval = setInterval(() => {
    timer++;
    elapsedTime++;
    timerDisplay.textContent = `Tiempo: ${timer} s | Mejor: ${bestTime} s`;
  }, 1000);
}

function drawMaze() {
  document.querySelectorAll(".cell").forEach(c => {
    c.className = "cell";
    c.textContent = "";
  });
  document.getElementById(`cell-${player.x}-${player.y}`).textContent = "👸"; // Princesa
  const goalCell = document.getElementById(`cell-${goal.x}-${goal.y}`);
  goalCell.classList.add("goal");
  goalCell.textContent = "🏰"; // Castllo
  teas.forEach(t => {
    const teaCell = document.getElementById(`cell-${t.x}-${t.y}`);
    teaCell.classList.add("tea");
    teaCell.textContent = "☕"; // Taza
  });
}

function move(dx, dy) {
  let nx = player.x + dx;
  let ny = player.y + dy;
  if (nx >= 0 && nx < cols && ny >= 0 && ny < rows) {
    player.x = nx;
    player.y = ny;
    teas = teas.filter(t => {
      if (t.x === player.x && t.y === player.y) {
        score++;
        scoreDisplay.textContent = `Puntaje: ${score} | Mejor: ${bestScore}`;
        return false;
      }
      return true;
    });
    drawMaze();

    if (player.x === goal.x && player.y === goal.y) {
      if (teas.length > 0) {
        warning.textContent = "⚠️ Te faltan tazas por recoger";
        setTimeout(() => { warning.textContent = ""; }, 2000);
      } else {
        warning.textContent = "";
        if (level < maxLevel) {
          levelMessage.textContent = `Nivel ${level} completado 🎉`;
          setTimeout(() => {
            levelMessage.textContent = "";
            level++;
            rows += 2;
            cols += 2;
            setupMaze();
          }, 1500);
        } else {
          clearInterval(timerInterval);
          if (elapsedTime < bestTime || bestTime == 0) {
            bestTime = elapsedTime;
            localStorage.setItem("bestTime", bestTime);
          }
          if (score > bestScore) {
            bestScore = score;
            localStorage.setItem("bestScore", bestScore);
          }
          finalMessage.innerHTML = `🎉 ¡Ganaste!<br>Puntaje: ${score} | Mejor: ${bestScore}<br>Tiempo total: ${elapsedTime}s | Mejor tiempo: ${bestTime}s`;
        }
      }
    }
  }
}

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") move(0, -1);
  if (e.key === "ArrowDown") move(0, 1);
  if (e.key === "ArrowLeft") move(-1, 0);
  if (e.key === "ArrowRight") move(1, 0);
});

function restartGame() {
  score = 0;
  level = 1;
  rows = 5;
  cols = 5;
  finalMessage.innerHTML = "";
  levelMessage.textContent = "";
  setupMaze();
}

function newMaze() {
  setupMaze();
}

setupMaze();
</script>
</body>
</html>
